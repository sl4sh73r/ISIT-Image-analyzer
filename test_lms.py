#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ LM Studio SDK
"""

import lmstudio as lms

print("="*60)
print("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ LM Studio SDK")
print("="*60)

# –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
print("\n1Ô∏è‚É£  –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ LM Studio...")
try:
    client = lms.Client()
    print("   ‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ")
except Exception as e:
    print(f"   ‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
    exit(1)

# –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
print("\n2Ô∏è‚É£  –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π...")
try:
    models = client.llm.list_loaded()
    print(f"   ‚úì –ù–∞–π–¥–µ–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(models)}")
    
    if len(models) == 0:
        print("   ‚ö†Ô∏è  –ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π!")
        print("\n   üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:")
        print("   1. –û—Ç–∫—Ä–æ–π—Ç–µ LM Studio")
        print("   2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª 'My Models'")
        print("   3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª—å (–Ω–∞–∂–º–∏—Ç–µ 'Load')")
        print("   4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞")
    else:
        print("\n   üìã –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:")
        for i, model in enumerate(models, 1):
            print(f"   {i}. {model.path}")
            
except Exception as e:
    print(f"   ‚úó –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞: {e}")

# –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–≤–∫–ª—é—á–∞—è –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ)
print("\n3Ô∏è‚É£  –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π...")
try:
    # –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥
    all_models = client.llm.list()
    print(f"   ‚úì –í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: {len(all_models)}")
    
    if len(all_models) > 0:
        print("\n   üìã –í—Å–µ –º–æ–¥–µ–ª–∏:")
        for i, model_info in enumerate(all_models, 1):
            # model_info –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–º
            if isinstance(model_info, str):
                print(f"   {i}. {model_info}")
            else:
                print(f"   {i}. {model_info}")
                
except AttributeError:
    print("   ‚ö†Ô∏è  –ú–µ—Ç–æ–¥ list() –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
except Exception as e:
    print(f"   ‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: {e}")

# –®–∞–≥ 4: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å
print("\n4Ô∏è‚É£  –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏...")
test_models = [
    "qwen/qwen3-vl-4b",
    "qwen3-vl-4b",
    "google/gemma-3-4b", 
    "gemma-3-4b",
    "gemma-2-2b-it"
]

print("   –ü—Ä–æ–±—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞:")
for model_name in test_models:
    print(f"\n   –ü–æ–ø—ã—Ç–∫–∞: {model_name}")
    try:
        model = client.llm.load_new_instance(model_name)
        print(f"   ‚úì –£–°–ü–ï–®–ù–û! –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞: {model_name}")
        print(f"   ‚ÑπÔ∏è  –ü—É—Ç—å: {model.path if hasattr(model, 'path') else 'unknown'}")
        
        # –í—ã–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å
        model.unload()
        print(f"   ‚úì –ú–æ–¥–µ–ª—å –≤—ã–≥—Ä—É–∂–µ–Ω–∞")
        break  # –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - –≤—ã—Ö–æ–¥–∏–º
        
    except Exception as e:
        error_str = str(e)
        if "not found" in error_str.lower():
            print(f"   ‚úó –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        elif "port" in error_str.lower():
            print(f"   ‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        else:
            print(f"   ‚úó –û—à–∏–±–∫–∞: {e}")

# –®–∞–≥ 5: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
print("\n" + "="*60)
print("üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò")
print("="*60)

print("\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª–∏ –≤ LM Studio:")
print("   - –û—Ç–∫—Ä–æ–π—Ç–µ LM Studio")
print("   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ 'My Models'")
print("   - –ù–∞–π–¥–∏—Ç–µ qwen3-vl-4b –∏ gemma-3-4b")
print("   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–ß–ù–û–ï –∏–º—è –º–æ–¥–µ–ª–∏ (–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ LM Studio)")

print("\n2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –≤—Ä—É—á–Ω—É—é:")
print("   - –í LM Studio –Ω–∞–∂–º–∏—Ç–µ 'Load' —Ä—è–¥–æ–º —Å –º–æ–¥–µ–ª—å—é")
print("   - –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏")
print("   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞")

print("\n3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Python SDK Server:")
print("   - Developer ‚Üí Python SDK Server ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'Running'")

print("\n" + "="*60)
print("‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
print("="*60)
