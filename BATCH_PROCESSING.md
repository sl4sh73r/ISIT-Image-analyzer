# Batch Processing - Обработка датасетов

## Что изменилось

Приложение теперь поддерживает загрузку и обработку **датасетов до 35 изображений** одновременно.

## Основные изменения архитектуры

### Backend (app.py)
- ✅ Увеличен лимит размера загрузки до **100 МБ** (было 16 МБ)
- ✅ Добавлен новый эндпоинт `/api/analyze-batch` для массовой обработки
- ✅ Добавлена константа `MAX_IMAGES_PER_BATCH = 35`
- ✅ Пакетная обработка с автоматической очисткой временных файлов
- ✅ Подробная статистика обработки (успешные/неудачные, общее и среднее время)

### Frontend (HTML/JS)
- ✅ Поддержка множественного выбора файлов (`multiple` атрибут)
- ✅ Drag & Drop для нескольких файлов одновременно
- ✅ Превью всех загруженных изображений в виде сетки
- ✅ Информация о датасете (количество фото, общий размер)
- ✅ Отображение результатов обработки в grid layout
- ✅ Индикаторы прогресса и статистики

### Стили (CSS)
- ✅ Grid layout для превью изображений (адаптивная сетка)
- ✅ Карточки результатов с визуальной индикацией успеха/ошибки
- ✅ Статистические блоки с метриками обработки
- ✅ Responsive дизайн для мобильных устройств

## Как использовать

### 1. Загрузка датасета
- Перетащите 1-35 изображений в область загрузки
- Или нажмите "Выбрать файлы" и выберите несколько файлов
- Поддерживаемые форматы: PNG, JPG, JPEG, GIF, BMP, WEBP
- Максимальный общий размер: 100 МБ

### 2. Обработка
- Загрузите нужную модель в LM Studio (Qwen или Gemma)
- Нажмите на соответствующую кнопку модели
- Приложение обработает все изображения последовательно

### 3. Результаты
- Общая статистика: успешных/ошибок, время обработки
- Карточка для каждого изображения с результатом
- Визуальная индикация успеха (зеленая рамка) или ошибки (красная рамка)
- Метрики: время обработки, скорость генерации токенов

## API Endpoints

### POST /api/analyze-batch
Обработка датасета изображений одной моделью.

**Параметры:**
- `images[]` (files) - Массив файлов изображений
- `model` (string) - Название модели (qwen/qwen3-vl-4b или google/gemma-3-4b)

**Ответ:**
```json
{
  "success": true,
  "results": [
    {
      "filename": "image1.jpg",
      "index": 0,
      "entity": "cat",
      "processing_time": 2.456,
      "success": true
    },
    ...
  ],
  "stats": {
    "total_images": 10,
    "successful": 10,
    "failed": 0,
    "total_processing_time": 24.56,
    "average_processing_time": 2.456
  }
}
```

## Ограничения
- Максимум **35 изображений** в одной загрузке
- Общий размер всех файлов не более **100 МБ**
- Обработка происходит последовательно (не параллельно)
- Требуется активная модель в LM Studio

## Производительность
При обработке 35 изображений:
- Среднее время на изображение: ~2-5 секунд
- Общее время обработки: ~2-3 минуты
- Зависит от производительности GPU и размера изображений

## Обратная совместимость
Старый режим работы (одно изображение) удален. Теперь все работает через новый batch-режим, который поддерживает как одно, так и множество изображений.
